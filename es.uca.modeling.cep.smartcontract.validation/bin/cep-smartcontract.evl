context SmartContract {
	constraint HasContractName {

	    check : self.typeName.isDefined() and self.typeName.trim().length() > 0
	
	    message : "Attribute 'typeName' must be named."
	    
	    fix {
	        
	    	title : "Set a value for 'name'."
	            
	        do {
	        	var name : String;
	            name = UserInput.prompt("Please enter a value for 'typeName':");
	            self.typeName = name;
	        }
	    }  

  	}
  	
  	constraint ExistContract {
    
    	guard : self.satisfies('HasContractName')
    
        check {
        
        	var m : String; 
        	m = "SmartContract '" + self.typeName; 
        	     	
        	if (self.typeName == "Voting" or self.typeName == "Purchase" or self.typeName == "Auction") {
        		return true;        	    
        	} else {
        		m = m + "' doesn´t exist.";
        		return false; 
        	}  
        }

        message : m
      
    } 	
}

context ContractFunction {
	constraint HasFunctiontName {

        check : self.name.isDefined() and self.name.trim().length() > 0

        message : 'Function must have a name.'

        fix {
        
            title : "Set a value for 'name'."
            
            do {
                var name : String;
                name = UserInput.prompt("Please enter a value for 'name':");
                self.name = name;
            }
        }      
    } 
    
    constraint ExistFunction {
    
    	guard : self.satisfies('HasFunctiontName')
    
        check {
        
        	var m : String; 
        	m = "ContractFunction '" + self.name; 
        		     	
        	switch(self.referencedSmartContract.typeName) {
        	case "Voting":
	        	if (self.name == "authorizeVoter" or self.name == "voteForCandidate" or self.name == "getVoteForCandidate" or self.name == "getAllCandidatesWithVotes" or self.name == "getTotalVotes") {
	        		return true;        	    
	        	} else {
	        		m = m + "' doesn´t exist for the SmartContract '" + self.referencedSmartContract.typeName + "'";
	        		return false; 
	        	} 
        		break;
        	case "Purchase":
        		if (self.name == "abort" or self.name == "confirmPurchase" or self.name == "confirmReceived") {
	        		return true;        	    
	        	} else {
	        		m = m + "' doesn´t exist for the SmartContract '" + self.referencedSmartContract.typeName + "'";
	        		return false; 
	        	} 
        		break;
        	case "Auction":
        		if (self.name == "bid" or self.name == "withdraw" or self.name == "auctionEnd") {
	        		return true;        	    
	        	} else {
	        		m = m + "' doesn´t exist for the SmartContract '" + self.referencedSmartContract.typeName + "'";
	        		return false; 
	        	} 
        		break;
        	default:
        		m = m + "' doesn´t exist";
        		return false; 
        		break;	
        	} 
        }

        message : m
      
    } 	
}

context Parameter {
	constraint HasParameterName {
    
        check : self.name.isDefined() and self.name.trim().length() > 0

        message : "Parameter must be named."

        fix {
        
            title : "Set a value for 'name'."
            
            do {
                var name : String;
                name = UserInput.prompt("Please enter a value for 'name':");
                self.name = name;
            }
        }      
    }    
         
    constraint HasParameterType {
    
    	guard : self.satisfies('HasParameterName')
    
        check {
        
        	var m : String; 
        	m = "Parameter '" + self.name; 
        	     	
        	if (self.type == PropertyTypeValue#Unknown) {
        		m = m + "' must have a type.";
        		return false;        	    
        	} else {
        		return true; 
        	}  
        }

        message : m
      
    }
    
    constraint HasCorrectType {
    
    	guard : self.satisfies('HasParameterType')
    
      	check {
        
        	var m : String; 
        	m = "Parameter '"; 
        	
        	if(self.isKindOf(InputParameter)){	     	
	        	switch(self.InputReferencedFunction.referencedSmartContract.typeName) {
	        	case "Voting":
			        switch(self.InputReferencedFunction.name) {	
				    	case "authorizeVoter":
				    		if (self.name == "_address" or self.name == "role" or self.name == "censo") {
				        		if (self.type == PropertyTypeValue#String) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.InputReferencedFunction.name + "'";
					        		return false; 
					        	}       	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		
				    		break;
				    	case "voteForCandidate":
				    		if (self.name == "_index") {
				        		if (self.type == PropertyTypeValue#Integer) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.InputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		break;
				    	case "getVoteForCandidate":
				    		if (self.name == "_index") {
				        		if (self.type == PropertyTypeValue#Integer) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.InputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		break;
				    	case "getAllCandidatesWithVotes":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	case "getTotalVotes":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	default:
				    		m = m + self.name + "' doesn´t exist";
				    		break;
				    }
	        		break;
	        	case "Purchase":
	        		switch(self.InputReferencedFunction.name) {	
				    	case "abort":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	case "confirmPurchase":
				    		if (self.name == "purchaseValue") {
				        		if (self.type == PropertyTypeValue#Integer) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.InputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		break;
				    	case "confirmReceived":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	default:
				    		m = m + self.name + "' doesn´t exist";
				    		break;
				    }
	        		break;
	        	case "Auction":
	        		switch(self.InputReferencedFunction.name) {	
				    	case "bid":
				    		if (self.name == "bidValue") {
				        		if (self.type == PropertyTypeValue#Integer) {
				        			return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.InputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		break;
				    	case "withdraw":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				  			
				    		break;
				    	case "auctionEnd":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	default:
				    		m = m + self.name + "' doesn´t exist";
				    		break;
				    }
	        		break;
	        	default:
	        		m = m + "' doesn´t exist";
	        		return false; 
	        		break;	
	        	} 
	        } else {
	        	switch(self.OutputReferencedFunction.referencedSmartContract.typeName) {
	        	case "Voting":
			        switch(self.OutputReferencedFunction.name) {	
				    	case "authorizeVoter":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}				    		
				    		break;
				    	case "voteForCandidate":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	case "getVoteForCandidate":
				    		if (self.name == "votes") {
				        		if (self.type == PropertyTypeValue#Integer) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		break;
				    	case "getAllCandidatesWithVotes":
				    		if (self.name == "CandidatesWithVotes") {
				        		if (self.type == PropertyTypeValue#String) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    		break;
				    	case "getTotalVotes":
				    		if (self.name == "TotalVotes") {
				        		if (self.type == PropertyTypeValue#String) {
				        		return true;        	    
					        	} else {
					        		m = m + self.name + "' doesn´t have the correct type for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
					        		return false; 
					        	}         	    
				        	} else {
				        		m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				        	} 
				    	break;
				    	default:
				    		m = m + self.name + "' doesn´t exist";
				    		break;
				    }
	        		break;
	        	case "Purchase":
	        		switch(self.OutputReferencedFunction.name) {	
				    	case "abort":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	case "confirmPurchase":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.InputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	case "confirmReceived":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    	default:
				    		m = m + self.name + "' doesn´t exist";
				    		break;
				    }
	        		break;
	        	case "Auction":
	        		switch(self.OutputReferencedFunction.name) {	
				    	case "bid":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    		break;
				    	case "withdraw":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    		break;
				    	case "auctionEnd":
				    		if(self.name.isDefined()){
				    			m = m + self.name + "' doesn´t exist for the ContractFunction '" + self.OutputReferencedFunction.name + "'";
				        		return false; 
				    		} else {
				    			return true;
				    		}
				    		break;
				    		break;
				    	default:
				    		m = m + self.name + "' doesn´t exist";
				    		break;
				    }
	        		break;
	        	default:
	        		m = m + "' doesn´t exist";
	        		return false; 
	        		break;	
	        	} 
	        }
        }

        message : m
    }
}